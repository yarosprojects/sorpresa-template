---
// export const prerender = false;
import Layout from "../layouts/Layout.astro";

let error = "";
if (Astro.request.method === "POST") {
	const formData = await Astro.request.formData();
	const accessKey = formData.get("access_key");

	if (accessKey === "sorpresa") {
		Astro.cookies.set("auth", "true", {
			path: "/",
			httpOnly: true,
			secure: true,
			sameSite: "lax",
			maxAge: 60 * 15,
		});

		return Astro.redirect("/sorpresa");
	} else {
		if(accessKey === "") {
			error = "Por favor, ingresa un c贸digo de acceso.";
		} else {
			error = "C贸digo de acceso incorrecto. Int茅ntalo de nuevo.";

		}
	}
}
---

<Layout title="Acceso">
	<section
		class="w-full min-h-screen flex flex-col justify-center items-center"
	>
		<header
			class="w-full md:max-w-xl flex flex-col justify-center items-center py-5"
		>
			<h1 class="text-3xl md:text-4xl font-bold text-center">
				隆La sorpresa del a帽o! 
			</h1>
			<p class="mt-4 text-base md:text-lg text-center w-full md:max-w-full max-w-xs">
				Ingresa el c贸digo para descubrir la sorpresa del a帽o.
			</p>
		</header>
		<form
			method="POST"
			class="p-3 w-full flex justify-center items-center flex-col"
			autocomplete="off"
		>
			<div
				class="flex flex-col md:flex-row w-full md:gap-0 gap-3 md:max-w-xl rounded-lg"
			>
				<div
					class="relative flex flex-col w-full rounded-xl shadow shadow-black/30 md:shadow-black/10"
				>
					<input
						maxlength="10"
						type="text"
						autocomplete="new-password"
						autocorrect="off"
						autocapitalize="off"
						spellcheck="false"
						name="access_key"
						placeholder=" "
						class="peer text-sm px-4 py-3 w-full rounded-xl border-none outline-none"
					/>
					<label
						for="access_key"
						class="absolute top-1/2 -translate-1/2 left-20 peer-focus:top-0 transition-all peer-focus:text-[13px] peer-focus:left-17 peer-focus:bg-white peer-focus:text-black/60 pointer-events-none peer-focus:px-px not-peer-placeholder-shown:top-0 not-peer-placeholder-shown:text-[13px] not-peer-placeholder-shown:left-17 not-peer-placeholder-shown:text-black/60 peer-focus-within:bg-white text-black/70"
						>C贸digo de acceso</label
					>
				</div>
				<div
					class="flex flex-col justify-center items-center px-0 md:px-2 w-full md:w-auto"
				>
					<button
						type="submit"
						class="px-4 py-2 bg-green-950 text-white rounded-lg w-full cursor-pointer hover:shadow hover:shadow-black/50 transition-all"
					>
						Entrar
					</button>
				</div>
			</div>
		</form>
		{
			error && (
				<div class="py-4 w-full flex justify-center items-center flex-col animate-fade-in-up" id="alert">
					<span class="text-red-500 text-sm">{error}</span>
				</div>
			)
		}
	</section>
</Layout>

<script is:inline>
	document.addEventListener('astro:page-load', () => {
		const alert = document.querySelector('#alert');
		const text = alert?.querySelector('span');

		if (alert && text) {
			setTimeout(() => {
				alert.classList.add('animate-fade-out');
				text.classList.add('animate-fade-out');

				setTimeout(() => {
					alert.remove();
				}, 600);
			}, 3000);
		}
	});
</script>

<style>
	input:-webkit-autofill,
	input:-webkit-autofill:hover,
	input:-webkit-autofill:focus,
	input:-webkit-autofill:active {
		-webkit-box-shadow: 0 0 0 1000px white inset !important;
		box-shadow: 0 0 0 1000px white inset !important;
		-webkit-text-fill-color: #000 !important;
		transition: background-color 9999s ease-in-out 0s;
	}
</style>